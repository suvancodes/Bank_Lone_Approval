<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Loan Approval Prediction</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body{
      background: linear-gradient(180deg,#071033 0%, #07142a 100%);
      color:#ffffff;
      font-family:system-ui,-apple-system,Roboto;
      padding-top:80px;
    }

    .navbar-brand{ color:white !important; font-weight:600; }
    h3, label { color:white !important; font-weight:700; }

    .card{
      background: rgba(255,255,255,0.10);
      border:1px solid rgba(255,255,255,0.20);
      backdrop-filter: blur(10px);
      border-radius:14px;
    }

    .form-control, .form-select{
      background:#f1f5f9;
      color:#041428;
      height:46px;
      font-weight:500;
    }

    .btn-primary{
      background: linear-gradient(90deg,#06b6d4,#4f46e5);
      border:0;
      font-weight:600;
    }

    /* LOADER */
    .loader{
      border: 6px solid rgba(255,255,255,0.2);
      border-top: 6px solid #4f46e5;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      animation: spin 1s linear infinite;
      margin:auto;
    }
    @keyframes spin { from { transform:rotate(0deg); } to { transform:rotate(360deg); } }

    /* RESULT */
    .approved, .rejected{
      padding:18px;
      border-radius:12px;
      font-size:1.1rem;
      animation: fadeIn .5s ease-in-out;
    }
    .approved{ background:#16a34a; border-left:6px solid #22c55e; }
    .rejected{ background:#dc2626; border-left:6px solid #f97316; }

    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar fixed-top" style="background:rgba(2,6,23,.85);">
    <div class="container d-flex justify-content-between">
      <a class="navbar-brand"><i class="bi bi-bank2 me-2"></i>Loan Approval Predictor</a>
      <a href="emi.html" class="btn btn-outline-light btn-sm">EMI Calculator</a>
    </div>
  </nav>

  <!-- MAIN FORM -->
  <main class="container my-5">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card p-4">

          <h3 class="mb-3">Loan Approval Prediction</h3>

          <!-- FORM -->
          <form id="predictForm" class="row g-3">

            <div class="col-12">
              <label class="form-label">Bank Name</label>
              <select id="Bank_Name" class="form-select" required>
                <option value="" disabled selected>Select bank</option>
                <option value="SBI bank">SBI Bank</option>
                <option value="AXIX bank">AXIS Bank</option>
                <option value="HDFC bank">HDFC Bank</option>
                <option value="Others">Others</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Gender</label>
              <select id="Gender" class="form-select">
                <option value="1">Male</option>
                <option value="0">Female</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Married</label>
              <select id="Married" class="form-select">
                <option value="1">Yes</option>
                <option value="0">No</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Education</label>
              <select id="Education" class="form-select">
                <option value="1">Graduate</option>
                <option value="0">Not Graduate</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Self Employed</label>
              <select id="Self_Employed" class="form-select">
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select>
            </div>

            <!-- UNITS UPDATED -->
            <div class="col-md-4">
              <label class="form-label">Applicant Income (₹ / Month)</label>
              <input type="number" id="ApplicantIncome" class="form-control" placeholder="5000" required>
            </div>

            <div class="col-md-4">
              <label class="form-label">Co-Applicant Income (₹ / Month)</label>
              <input type="number" id="CoapplicantIncome" class="form-control" placeholder="1500" required>
            </div>

            <div class="col-md-4">
              <label class="form-label">Loan Amount (₹ Thousands)</label>
              <input type="number" id="LoanAmount" class="form-control" placeholder="128 → ₹128000" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Loan Term (Months)</label>
              <input type="number" id="Loan_Amount_Term" class="form-control" placeholder="360 months" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Credit History</label>
              <select id="Credit_History" class="form-select">
                <option value="1">Good (1)</option>
                <option value="0">Bad (0)</option>
              </select>
            </div>

            <div class="col-12 text-end">
              <button class="btn btn-primary" type="submit">Predict</button>
            </div>

          </form>

          <!-- LOADING -->
          <div id="loadingBox" class="text-center mt-4" style="display:none;">
            <div class="loader"></div>
            <p class="text-light mt-2">Predicting... please wait</p>
          </div>

          <!-- RESULT -->
          <div id="result" class="mt-4" style="display:none;">
            <div id="resultBox"></div>
          </div>

        </div>
      </div>
    </div>
  </main>

  <!-- KEEP RENDER SERVER ALIVE -->
  <script>
    setInterval(() => {
      fetch("https://bank-lone-approval-1.onrender.com/")
      .catch(()=>{});
    }, 240000);
  </script>

  <!-- PREDICTION SCRIPT -->
  <script>
    const BACKEND_URL = "https://bank-lone-approval-1.onrender.com/predict";

    document.getElementById("predictForm").addEventListener("submit", async (e)=>{
      e.preventDefault();

      const fields = [
        "Bank_Name","Gender","Married","Education","Self_Employed",
        "ApplicantIncome","CoapplicantIncome","LoanAmount",
        "Loan_Amount_Term","Credit_History"
      ];

      // Validate
      for (let id of fields){
        if (!document.getElementById(id).value){
          alert("⚠ Please fill all fields before predicting.");
          return;
        }
      }

      document.getElementById("loadingBox").style.display = "block";
      document.getElementById("result").style.display = "none";

      const payload = {};
      fields.forEach(id => payload[id] = document.getElementById(id).value);

      const res = await fetch(BACKEND_URL,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify(payload)
      });

      const data = await res.json();
      const label = data.result.label;
      const box = document.getElementById("resultBox");

      if(label === "Approved"){
        box.innerHTML = `
          <div class="approved">
            <strong>Loan Approved ✔</strong><br>
            Your loan has high chances of approval based on the provided inputs.
          </div>
        `;
      } else {
        box.innerHTML = `
          <div class="rejected">
            <strong>Loan Rejected ✘</strong><br>
            The model predicts this loan may not be approved.
          </div>
        `;
      }

      document.getElementById("loadingBox").style.display = "none";
      document.getElementById("result").style.display = "block";
    });
  </script>

</body>
</html>
